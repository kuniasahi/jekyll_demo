---
layout: post
author: yuguoxu
author_url: http://yuguoxusblog.tk/
author_email: yokuniasahi@gmail.com
title: Android 4.1上完全不使用GPU
published_date: 2013-2-17
---

<p>
       从目前的发展来看，Android系统越来越依赖GPU Rending，GPU更多的时候接的是2D渲染的活，但这并不表明Android非要GPU不可，没有GPU的时候skia笑了，本文就是想办法让Android
   不采用GPU，或者说是创造一个没有GPU的环境。
</p>

<p>
       为什么要做这样的事呢，主要是在调试过程中有用，因为GPU驱动往往是不开源的，即使开源了Soc厂商也看不懂或者没时间看，这样代码中相当与多了一个黑模块，这个模块导致耦合性问题
   可能会花很长时间才查得出，因此需要一种对比的方法，二来去掉GPU驱动也可以让大家见识一下GPU的威力，正所谓失去了才知道重要嘛。
</p>

<p>
   好了，废话不多说，交代要改的地方：
</p>

<p>
  在方案配置目录下，修改方案的主配置文件，增加下面这个属性，我的是CPU是Allwinner A31,也就是修改fiber-xxxx.mk这个文件
</p>
     <div style="background:#fdfdfd;color:black;"><u>Makefile语言</u>: <a href="http://fayaa.com/code/">高亮代码由发芽网提供</a></div>
     <div style="font-family: &quot;[object HTMLOptionElement]&quot;,&quot;Courier New&quot;,&quot;monospace&quot;; color: rgb(0, 0, 0);" class="source"><span style="color: rgb(0, 0, 0);">PRODUCT_PROPERTY_OVERRIDES</span> <span style="color: rgb(0, 0, 0);">+=</span> <span style="color: rgb(0, 0, 255);">\</span><br> &nbsp; &nbsp;debug.force.software.rending<span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">true</span><br></div>

<p>
  去掉GPU库，这个按照方案不同，A31是通过mk文件PRODUCT_COPY_FILES的，也就是注释掉下面的：
</p>

     <div style="background:#fdfdfd;color:black;"><u>Makefile语言</u>: <a href="http://fayaa.com/code/">高亮代码由发芽网提供</a></div>
     <div style="font-family: &quot;[object HTMLOptionElement]&quot;,&quot;Courier New&quot;,&quot;monospace&quot;; color: rgb(0, 0, 0);" class="source"><span style="color: rgb(0, 136, 0); font-style: italic;">#egl</span><br><span style="color: rgb(0, 136, 0); font-style: italic;">#PRODUCT_COPY_FILES += \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/pvrsrvctl:system/vendor/bin/pvrsrvctl \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libusc.so:system/vendor/lib/libusc.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libglslcompiler.so:system/vendor/lib/libglslcompiler.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libIMGegl.so:system/vendor/lib/libIMGegl.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libpvr2d.so:system/vendor/lib/libpvr2d.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libpvrANDROID_WSEGL.so:system/vendor/lib/libpvrANDROID_WSEGL.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libPVRScopeServices.so:system/vendor/lib/libPVRScopeServices.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libsrv_init.so:system/vendor/lib/libsrv_init.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libsrv_um.so:system/vendor/lib/libsrv_um.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libEGL_POWERVR_SGX544_115.so:system/vendor/lib/egl/libEGL_POWERVR_SGX544_115.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libGLESv1_CM_POWERVR_SGX544_115.so:system/vendor/lib/egl/libGLESv1_CM_POWERVR_SGX544_115.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/libGLESv2_POWERVR_SGX544_115.so:system/vendor/lib/egl/libGLESv2_POWERVR_SGX544_115.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/gralloc.sun6i.so:system/vendor/lib/hw/gralloc.sun6i.so \</span><br><span style="color: rgb(0, 136, 0); font-style: italic;"># &nbsp; &nbsp; &nbsp; device/softwinner/fiber-common/egl/egl.cfg:system/lib/egl/egl.cfg</span><br></div>

<p>
  在BoardConfig.mk中添加：
</p>  

     <div style="background:#fdfdfd;color:black;"><u>Makefile语言</u>: <a href="http://fayaa.com/code/">高亮代码由发芽网提供</a></div>
     <div style="font-family: &quot;[object HTMLOptionElement]&quot;,&quot;Courier New&quot;,&quot;monospace&quot;; color: rgb(0, 0, 0);" class="source"><span style="color: rgb(0, 0, 0);">USE_HW_COMPOSER</span> <span style="color: rgb(0, 0, 0);">:=</span> <span style="color: rgb(0, 0, 0);">false</span><br></div>

<p>
  去掉对hwcomposer模块的引用，这个根据平台不同，A31的是在fiber-common中，删除fiber-common.mk中的引用
</p>

<p>
  这样重新编译，make installclean;make -j14烧写后系统能够起来，速度慢得一B，但进入主角面爆错，logcat提示是Wallpaper出错，估计是明知不能使用硬件渲染还用吧，把它禁掉，
  删除frameworks/base/core/res/res/values/config.xml,把"config_enableWallpaperService设置成false
</p>
<p>
  系统能跑起来也正常了，果然视网膜屏的带动需要GPU很大的支持，skia已经显得心有力而气不足了
</p>    
<p>
    以后会写一些更多关于android的东西，学习路上，与君共勉！
</p>

